@page "/"
@using MemoryEngine
@using Card = MemoryGame.Components.Card

<PageTitle>Welcome to memory !</PageTitle>

@if (!_game.IsGameStarted)
{
    <button @onclick="StartGame">START NEW GAME</button>
} 
else
{
    <div class="flex flex-row justify-center">
        <div class="grid grid-rows-[max-content,max-content,max-content,max-content] grid-cols-[max-content,max-content,max-content,max-content] gap-8">
            @foreach (var card in _game.Cards) {
            <div><Card Background="@BackgroundId" Source="card" OnClick="OnClick"></Card></div>
            }
        </div>
    </div>
}

@code
{
    private GridGame _game = new(Player.Player1, Player.Player2);
    private int BackgroundId { get; set; } = 1;

    private void StartGame()
    {
        BackgroundId = Random.Shared.Next(1, 4);
        _game = new GridGame(Player.Player1, Player.Player2);
        _game.Start();
    }

    public async Task OnClick(MemoryEngine.Card card)
    {
        if (_game.Show(card.CardId) == 2)
        {
            await Task.Delay(1000);
            _game.Check();
        }
        
    }
}
